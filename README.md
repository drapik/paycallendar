# Paycallendar

Веб‑сервис для расчёта платёжного календаря: учитывает остатки по счетам, ожидаемые поступления, заказы поставщикам с авансами и показывает кассовые разрывы.

## Возможности
- Добавление нескольких счетов с редактируемым балансом и расчёт общего остатка.
- Учёт ожидаемых поступлений (фиксированных и плановых) с датами и комментариями.
- Заказы поставщикам с авансом, датой финального платежа и кнопкой проверки на кассовый разрыв перед сохранением.
- Выгрузка заказов поставщикам из МойСклад по сервисной кнопке в конфигурационном блоке.
- Таймлайн доступных средств, ежедневная статистика операций (DDR) и автоматическое предупреждение о кассовом разрыве.
- Калькулятор баланса на выбранную дату.

## Запуск
1. Быстрый старт (создаёт `.env.local`, если его нет, и ставит зависимости):
   ```bash
   ./run/maintenance_setup.sh
   ```
   Скрипт подхватит значения `SUPABASE_URL` и `SUPABASE_KEY` из окружения, если они заданы перед запуском.
2. Если предпочитаете вручную, то:
   ```bash
   npm install
   cp .env.example .env.local
   # заполните SUPABASE_URL и SUPABASE_KEY
   ```
3. Разверните структуру БД в Supabase через SQL Editor, выполнив содержимое файла `supabase/schema.sql`.
4. Запустите dev‑сервер:
   ```bash
   npm run dev
   ```
5. Откройте http://localhost:3000 и заполните счета, поступления и заказы.

## Работа с данными
- Все операции идут через Supabase (`SUPABASE_URL` и `SUPABASE_KEY` берутся из переменных окружения).
- Проверка заказа вызывает `/api/orders/check` и возвращает сумму потенциального кассового разрыва.
- Вкладка «Дневная статистика (DDR)» показывает события за день и итоговый баланс.

## Структура проекта
- `src/app/page.tsx` — основной экран с формами и визуализациями.
- `src/lib/cashflow.ts` — расчётный движок (таймлайн, кассовые разрывы, калькулятор дат).
- `src/app/api/*` — API‑маршруты для работы с Supabase.
- `supabase/schema.sql` — SQL‑скрипт для создания таблиц и индексов.

## Переменные окружения
- `SUPABASE_URL` — URL проекта в Supabase.
- `SUPABASE_KEY` — service role ключ (используется сервером для записи/чтения данных).
- `MOYSKLAD_TOKEN` — API‑токен МойСклад (нужен для выгрузки заказов поставщикам по кнопке «Выгрузить заказы из МойСклад»).

## Работа без бинарных файлов
Инструменты создания PR в Codex не поддерживают бинарные артефакты (иконки, скриншоты, архивы). Чтобы избежать ошибок при открытии PR:
- не коммитьте изображения и прочие бинарные файлы; при необходимости размещайте медиа во внешнем хранилище либо инлайните SVG‑графику в код;
- `.gitignore` уже исключает распространённые форматы изображений (png, jpg, svg и т.д.), чтобы предотвратить случайные коммиты;
- если бинарный файл всё же попал в индекс, удалите его командой `git rm --cached <путь>` перед публикацией изменений.
